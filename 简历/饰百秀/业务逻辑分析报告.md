# Special 项目业务逻辑分析报告

## 项目概述

Special 是一个面向建筑/装修行业的项目管理系统，主要用于管理项目全生命周期，包括客户管理、项目管理、任务分配、进度跟踪等功能。

## 核心业务模块

### 1. 用户认证与权限管理

#### 登录机制
- **飞书登录集成**: 使用飞书作为主要登录方式
- **Token验证**: 通过 `/index/home/check_token` 验证用户登录状态
- **权限控制**: 基于角色的权限管理系统

#### API接口
```javascript
// 登录相关
/index/login/feishu_login    // 飞书登录
/auth/info                  // 获取用户信息
/index/home/check_token     // 验证Token
```

### 2. 客户管理模块 (Customer Management)

#### 核心功能
- **客户信息管理**: 客户基本信息的增删改查
- **地址管理**: 省市区三级联动地址选择
- **项目关联**: 跟踪客户是否有关联项目

#### 业务流程
1. **客户录入**: 添加客户基本信息（姓名、电话、地址等）
2. **客户查询**: 支持按姓名搜索客户
3. **客户详情**: 查看客户详细信息和关联项目状态
4. **项目关联**: 标记客户是否已创建项目

#### API接口
```javascript
/customer/index/index              // 获取客户列表
/customer/index/add               // 添加客户
/customer/index/edit              // 编辑客户
/customer/index/select_customer_list  // 选择客户列表
/customer/index/customer_info     // 获取客户信息
```

### 3. 项目管理模块 (Project Management)

#### 项目生命周期管理
项目按照建筑行业标准流程分为以下阶段：

1. **方案阶段 (Proposal)**
   - 项目方案设计
   - 方案任务创建和分配
   - 方案提交和审核

2. **设计阶段 (Design)**
   - 详细设计图纸
   - 设计任务管理
   - 设计成果提交

3. **施工阶段 (Construction)**
   - 施工任务分配
   - 进度跟踪
   - 子进度管理
   - 普通任务处理

4. **保障阶段 (Ensure)**
   - 质量保障
   - 售后服务
   - 维护任务

#### 项目核心功能

##### 项目基础管理
- **项目创建**: 创建新项目，关联客户信息
- **项目列表**: 显示所有项目，支持搜索
- **项目详情**: 查看项目基本信息、进度、任务等
- **项目成员**: 管理项目团队成员

##### 任务管理系统
- **任务创建**: 为不同阶段创建相应任务
- **任务分配**: 将任务分配给具体执行人员
- **任务提交**: 执行人员提交任务成果
- **任务审核**: 管理人员审核任务完成情况
- **延期管理**: 跟踪和处理延期任务

#### API接口详解

##### 项目基础接口
```javascript
/project/index/show_list          // 项目列表
/project/index/create_project     // 创建项目
/project/index/detail            // 项目详情
/project/index/save_detail       // 保存项目详情
/project/index/get_project_info  // 获取项目信息
/project/index/task_list         // 任务列表
/project/index/start_task        // 开始任务
```

##### 方案阶段接口
```javascript
/project/proposal/index                    // 方案列表
/project/proposal/create_proposal_task     // 创建方案任务
/project/proposal/submit_proposal_task     // 提交方案任务
/project/proposal/examine_proposal_task    // 审核方案任务
/project/proposal/expload_proposal         // 导出方案
```

##### 设计阶段接口
```javascript
/project/design/index                 // 设计列表
/project/design/before_create_task    // 创建任务前置操作
/project/design/create_design_task    // 创建设计任务
/project/design/after_create_task     // 创建任务后置操作
/project/design/submit_design_task    // 提交设计任务
/project/design/examine_design_task   // 审核设计任务
/project/design/expload_design        // 导出设计
```

##### 施工阶段接口
```javascript
/project/construction/index                    // 施工列表
/project/construction/before_create_task       // 创建任务前置操作
/project/construction/create_construction_task // 创建施工任务
/project/construction/after_create_task        // 创建任务后置操作
/project/construction/submit_construction_task // 提交施工任务
/project/construction/examine_construction_task // 审核施工任务
/project/construction/child_schedule           // 子进度管理
/project/construction/submit_child_schedule    // 提交子进度
/project/construction/get_ordinary_task        // 获取普通任务
/project/construction/submit_ordinary_task     // 提交普通任务
```

##### 保障阶段接口
```javascript
/project/ensure/index                 // 保障列表
/project/ensure/before_create_task    // 创建任务前置操作
/project/ensure/create_ensure_task    // 创建保障任务
/project/ensure/after_create_task     // 创建任务后置操作
/project/ensure/submit_ensure_task    // 提交保障任务
/project/ensure/examine_ensure_task   // 审核保障任务
/project/ensure/expload_ensure        // 导出保障信息
```

### 4. 订单管理模块 (Order Management)

#### 核心功能
- **订单信息管理**: 管理项目相关的订单信息
- **供应商管理**: 管理订单供应商信息
- **订单状态跟踪**: 跟踪订单处理状态

#### API接口
```javascript
/project/order/index                // 订单列表
/project/order/save_index          // 保存订单
/project/order/get_supplier        // 获取供应商
/project/order/project_order_info   // 项目订单信息
/project/order/submit_project_order_info // 提交项目订单信息
```

### 5. 周计划管理模块 (Week Plan)

#### 核心功能
- **周计划制定**: 制定每周工作计划
- **计划跟踪**: 跟踪计划执行情况

#### API接口
```javascript
/project/weekplan/index            // 周计划列表
/project/weekplan/create_week_plan // 创建周计划
```

## 业务流程分析

### 典型业务流程

#### 1. 客户到项目的完整流程
```
客户录入 → 需求沟通 → 项目创建 → 方案设计 → 设计深化 → 施工实施 → 质量保障
```

#### 2. 项目任务管理流程
```
任务创建 → 任务分配 → 任务执行 → 成果提交 → 任务审核 → 任务完成/返工
```

#### 3. 项目阶段流程
```
方案阶段 → 设计阶段 → 施工阶段 → 保障阶段
```

### 权限控制逻辑

#### 角色分类
- **管理员**: 全权限，可以管理所有模块
- **项目经理**: 项目管理权限，可以创建和管理项目
- **设计师**: 设计阶段任务权限
- **施工人员**: 施工阶段任务权限
- **普通用户**: 基础查看权限

#### 权限控制点
- **项目访问**: 只能访问自己参与的项目
- **任务操作**: 只能操作分配给自己的任务
- **审核权限**: 只有管理员和项目经理可以审核任务
- **数据导出**: 需要特定权限才能导出数据

## 技术架构分析

### 前端架构
- **Vue 3 + TypeScript**: 现代化前端框架
- **Vant UI**: 移动端优化的UI组件库
- **Vue Router**: 路由管理
- **Vuex**: 状态管理
- **Axios**: HTTP请求库

### 后端架构
- **Node.js + Express**: 轻量级后端框架
- **MySQL**: 关系型数据库
- **Redis**: 缓存和会话存储
- **API转发**: 通过Node.js转发到PHP后端

### 数据流向
```
移动端App → Node.js中间层 → PHP后端 → MySQL数据库
```

## 业务特点总结

### 优势
1. **行业针对性强**: 专门针对建筑装修行业设计
2. **流程标准化**: 按照行业标准划分项目阶段
3. **移动端优化**: 适合现场作业人员使用
4. **任务管理完善**: 支持复杂的任务分配和跟踪

### 改进建议
1. **增加消息通知**: 任务状态变更时及时通知相关人员
2. **完善报表功能**: 增加项目进度、成本等报表
3. **优化文件管理**: 加强项目文档和图纸管理
4. **增加移动端功能**: 如拍照上传、GPS定位等

## 数据模型分析

### 核心实体关系
```
客户 (Customer) 1:N 项目 (Project)
项目 (Project) 1:N 任务 (Task)
项目 (Project) N:M 用户 (User) [项目成员]
任务 (Task) N:1 用户 (User) [任务执行人]
项目 (Project) 1:N 订单 (Order)
```

### 关键字段分析
- **项目状态**: 方案/设计/施工/保障
- **任务状态**: 未开始/进行中/已提交/已审核/已完成
- **用户角色**: 管理员/项目经理/设计师/施工人员
- **延期标识**: 标记延期任务便于管理

这个系统是一个典型的项目管理系统，专门为建筑装修行业定制，具有完整的业务流程和权限控制机制。
